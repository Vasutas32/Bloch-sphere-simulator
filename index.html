<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bloch-gömb szimulátor</title>
    <base href="BlochSphereSimulator" />
    <link rel="stylesheet" href="css/app.css" />
    <!-- Plotly.js könyvtár betöltése a 3D megjelenítéshez -->
    <script src="js/plotly.min.js"></script>
</head>
<!-- Body padding: 0 maradt, hogy a lábléc szélei elérjék a képernyő szélét -->
<body style="display: flex; flex-direction: column; min-height: 100vh; margin: 0; padding: 0;">

    <!-- Tartalom padding: 20px maradt, a szép elrendezésért -->
    <div id="app" style="flex: 1; padding: 20px;">
        <!-- Blazor betöltéséig megjelenő tartalom -->
        <component type="typeof(App)" render-mode="WebAssembly" />
    </div>
    
    <!-- JAVÍTÁS: padding: 15px 0; hozzáadva, hogy a sáv magasabb legyen -->
    <footer style="background-color: #f8f9fa; text-align: center; border-top: 1px solid #dee2e6; font-size: 0.9rem; padding: 15px 0;">
        Készítette: <strong>Varga Marcell Simon és Borvendég Benedek</strong>
    </footer>

    <script src="_framework/blazor.webassembly.js"></script>
    
    <!-- Bloch-gömb kirajzoló szkript -->
    <script>
        // Ez a függvény végzi a Bloch-gömb és az állapotvektorok megjelenítését
        function drawBlochSphere(x, y, z, snapshots) {
            const nu = 30, nv = 30; // Rácspontok felbontása
            const xs = [], ys = [], zs = [];

            // Gömb felületének pontjainak generálása
            for (let i = 0; i <= nu; i++) {
                xs[i] = []; ys[i] = []; zs[i] = [];
                const u = (i * Math.PI) / nu;
                for (let j = 0; j <= nv; j++) {
                    const v = (j * 2 * Math.PI) / nv;
                    // Szférikus -> Descartes koordináta transzformáció
                    xs[i][j] = Math.sin(u) * Math.cos(v);
                    ys[i][j] = Math.sin(u) * Math.sin(v);
                    zs[i][j] = Math.cos(u);
                }
            }

            // 1. A gömb felszínének definíciója (átlátszó drótváz)
            const sphere = {
                type: 'surface',
                x: xs, y: ys, z: zs,
                opacity: 0.2,
                showscale: false
            };

            // 2. Az aktuális állapot végpontjának jelölése
            const current = {
                type: 'scatter3d',
                mode: 'markers',
                x: [x], y: [y], z: [z],
                marker: { size: 8, color: '#3498db' },
                name: 'Aktuális',
                showlegend: false
            };

            // 3. Az állapotvektor vonala a középpontból
            const vector = {
                type: 'scatter3d',
                mode: 'lines', 
                x: [0, x], y: [0, y], z: [0, z], 
                line: { width: 4, color: '#3498db' },
                name: 'Bloch Vektor',
                showlegend: true 
            };

            // 4. Mentett pillanatképek (snapshots) feldolgozása
            const snaps = snapshots.map(s => ({
                type: 'scatter3d',
                mode: 'markers',
                x: [s.x], y: [s.y], z: [s.z],
                marker: { size: 6, color: s.color },
                name: s.label
            }));

            // Elrendezés beállításai (tengelyek, méretarány)
            const layout = {
                scene: {
                    xaxis: { range: [-1, 1] },
                    yaxis: { range: [-1, 1] },
                    zaxis: { range: [-1, 1] },
                    aspectmode: 'cube'
                },
                margin: { l: 0, r: 0, t: 0, b: 0 },
                showlegend: true,
                // Jelmagyarázat (legend) alulra (y: 0)
                legend: { x: 0, y: 0 }
            };

            // A diagram kirajzolása a 'sphere' azonosítójú div-be
            Plotly.newPlot('sphere', [sphere, vector, current, ...snaps], layout, { responsive: true });
        }
    </script>
</body>
</html>
